---
import Loader from "../components/Loader.astro";
import { getSession } from "auth-astro/server";
import { db, Storage } from "astro:db";
import { eq } from "astro:db";

const session = await getSession(Astro.request);

const userId = session.user.id;

const userStorageData = await db
  .select()
  .from(Storage)
  .where(eq(Storage.userId, userId));
const usage = userStorageData[0].storage / 1024 / 1024 / 1024;
const footprint = usage * 0.8;
---

<section class="w-full h-screen mt-[8rem] bg-bg-gray px-[4rem]">
  <!-- <Loader /> -->
  <div class="flex items-center gap-5">
    <h1 class="text-primary text-6xl tracking-tighter font-medium title-text">
      Hello {session.user.name}!
    </h1>
    <img
      src={session.user.image}
      class="picture rounded-full"
      width="60"
      height="60"
      alt="user profile picture"
    />
  </div>
  <div>
    <h2 class="text-white font-medium text-lg mt-2">
      Your storage usage: <span class="text-primary"
        >{usage.toFixed(2)} GB</span>
    </h2>

    <p class="text-white font-medium text-lg tracking-tighter storageContainer">
    </p>

    <p class="text-white font-medium text-lg tracking-tighter">
      Your footprint is: <span class="text-primary"
        >{footprint.toFixed(2)} of CO2 per GB</span
      ><span class="footprintContainer text-primary"></span>
    </p>
  </div>
</section>
